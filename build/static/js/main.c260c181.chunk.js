(this["webpackJsonpmini-app"]=this["webpackJsonpmini-app"]||[]).push([[0],{179:function(e,t,s){},184:function(e,t,s){"use strict";s.r(t);var i=s(1),n=s.n(i),a=s(29),c=s.n(a),o=s(13),l=s.n(o),r=s(2),d=s(3),h=s(5),p=s(6),b=s(26),u=(s(178),s(179),s(15)),g=s.p+"static/media/logo.675c0730.png",m=s.p+"static/media/add.758b81d9.png",j=s.p+"static/media/empty.d76886bf.png",v=s.p+"static/media/settings.1906753f.svg",S=s.p+"static/media/text.1c5d2b5d.svg",f=s.p+"static/media/image.a4bad6fb.svg",O=s.p+"static/media/pen.b9054b56.svg",_=s(4),x=function(e){Object(h.a)(s,e);var t=Object(p.a)(s);function s(e){var i;return Object(r.a)(this,s),(i=t.call(this,e)).onTypePicked=function(e){i.props.onTypePicked(e),i.props.hidePicker()},i}return Object(d.a)(s,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this;return Object(_.jsxs)("div",{className:this.props.isShowTypePicker?"appeal_container_bg_shown":"appeal_container_bg_hiden sdk_appeal_header",children:[Object(_.jsx)("div",{onClick:this.props.hidePicker,className:this.props.isShowTypePicker?"animateAppealBgShow":"animateAppealBgHide sdk_appeal_header"}),Object(_.jsx)("div",{className:this.props.isShowTypePicker?"appeal_container_shown":"appeal_container_hide sdk_appeal_header",children:Object(_.jsxs)("div",{className:"picker_cont",children:[Object(_.jsx)("p",{className:"picker_title",children:"\u041e\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u0433\u0440\u0430\u0444"}),Object(_.jsxs)("div",{onClick:function(){return e.onTypePicked(0)},className:"picker_item",children:[Object(_.jsx)("img",{className:"picker_img",src:S}),Object(_.jsx)("p",{className:"picker_text",children:"\u0422\u0435\u043a\u0441\u0442\u043e\u0432\u044b\u0439"})]}),Object(_.jsxs)("div",{onClick:function(){return e.onTypePicked(1)},className:"picker_item",children:[Object(_.jsx)("img",{className:"picker_img",src:f}),Object(_.jsx)("p",{className:"picker_text",children:"\u041a\u0430\u0440\u0442\u0438\u043d\u043a\u0430"})]}),Object(_.jsxs)("div",{onClick:function(){return e.onTypePicked(2)},className:"picker_item",children:[Object(_.jsx)("img",{className:"picker_img",src:O}),Object(_.jsx)("p",{className:"picker_text",children:"\u041d\u0430\u0440\u0438\u0441\u043e\u0432\u0430\u0442\u044c"})]})]})})]})}}]),s}(n.a.Component),k=s.p+"static/media/left.a78d9a4b.svg",A=s(16),w=function(e){Object(h.a)(s,e);var t=Object(p.a)(s);function s(e){var i;return Object(r.a)(this,s),(i=t.call(this,e)).saveSign=function(){var e=i.props.user,t=i.props.dbUser,s={type:0,text:i.state.text,name:e.first_name+" "+e.last_name,user_id:e.id};void 0==t.album||0==t.album.length?t.album=[s]:(void 0!=t.album&&t.album.length>1&&t.album.reverse(),t.album.push(s)),console.log("saveSign user = "+JSON.stringify(t)),Object(A.d)(Object(A.c)(i.props.db,"albums/"+t.user.id),t),i.props.onTypePicked(-1)},i.state={text:""},i.handleChange=i.handleChange.bind(Object(u.a)(i)),i}return Object(d.a)(s,[{key:"componentDidMount",value:function(){}},{key:"handleChange",value:function(e){if(e){var t=e.target.value;this.setState({text:t})}}},{key:"render",value:function(){var e=this;return Object(_.jsxs)("div",{className:"text_sign_screen",children:[Object(_.jsxs)("div",{className:"nav_text_sign",children:[Object(_.jsx)("div",{onClick:function(){return e.props.onTypePicked(-1)},className:"back_cont",children:Object(_.jsx)("img",{src:k})}),Object(_.jsx)("p",{className:"sign_title",children:"\u041e\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u0433\u0440\u0430\u0444"})]}),Object(_.jsx)("textarea",{className:"sign_textarea",placeholder:"\u0412\u0430\u0448 \u0442\u0435\u043a\u0441\u0442",onChange:this.handleChange,value:this.state.text}),Object(_.jsx)("div",{onClick:this.saveSign,className:"center_hor sign_text_btn",children:"\u041e\u0441\u0442\u0430\u0432\u0438\u0442\u044c"})]})}}]),s}(n.a.Component),y=(s.p,function(e){Object(h.a)(s,e);var t=Object(p.a)(s);function s(e){var i;return Object(r.a)(this,s),(i=t.call(this,e)).share=function(){l.a.send("VKWebAppShowStoryBox",{background_type:"image",url:i.props.item.url})},i.createSticker=function(e){return{sticker_type:"renderable",sticker:{content_type:"image",url:e,clickable_zones:[{action_type:"link",action:{link:"https://vk.com/8213105",tooltip_text_key:"tooltip_open_default"}}]}}},i}return Object(d.a)(s,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return Object(_.jsxs)("div",{className:"album_item",children:[0==this.props.item.type&&Object(_.jsx)("div",{className:"just_cont",children:Object(_.jsx)("p",{className:"item_text",children:this.props.item.text})}),(1==this.props.item.type||2==this.props.item.type)&&Object(_.jsxs)("div",{className:"relative",children:[Object(_.jsx)("img",{style:2==this.props.item.type?{backgroundColor:"white"}:{},className:"item_img",src:this.props.item.url}),this.props.isMyAlbum&&Object(_.jsx)("img",{onClick:this.share,className:"share_img",src:"data:image/png;base64,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"})]}),Object(_.jsx)("div",{className:"line"}),Object(_.jsx)("p",{className:"item_desc",children:this.props.item.name})]})}}]),s}(n.a.Component)),N=s(18);function C(e,t){Object(A.d)(Object(A.c)(e,"albums/"+t.user.id),t)}function B(e){var t,s,i=window.location.search.substring(1).split("&");for(s=0;s<i.length;s++)if((t=i[s].split("="))[0]===e)return void 0===t[1]?void 0:decodeURIComponent(t[1])}var U=function(e,t,s,i){var n=parseInt(e);switch(n>100&&(n%=100),n>20&&(n%=10),n){case 1:return t;case 2:case 3:case 4:return s;default:return i}},F=s.p+"static/media/check.50686e2c.svg",P=function(e){Object(h.a)(s,e);var t=Object(p.a)(s);function s(e){var i;Object(r.a)(this,s),(i=t.call(this,e)).toggleSigns=function(){i.state.isShowSignSettings?i.setState({isShowSignSettings:!i.state.isShowSignSettings}):i.state.isShowAlbumSettings&&i.setState({isShowAlbumSettings:!i.state.isShowAlbumSettings})},i.showSignSettings=function(){i.setState({isShowSignSettings:!0})},i.toggleAlbum=function(){i.setState({isShowAlbumSettings:!i.state.isShowAlbumSettings})},i.signSetAll=function(){i.setState({isShowSetFriendsSign:!1});var e=i.props.dbUser;void 0!=e.can_sign_list&&e.can_sign_list.length>0&&(e.can_sign_list=[],C(i.props.db,e))},i.signWatchAll=function(){i.setState({isShowSetFriendsWatch:!1});var e=i.props.dbUser;void 0!=e.can_watch_list&&e.can_watch_list.length>0&&(e.can_watch_list=[],C(i.props.db,e))},i.signSetFriends=function(){i.setState({isShowSetFriendsSign:!0})},i.signSetWatch=function(){i.setState({isShowSetFriendsWatch:!0})},i.close=function(){i.setState({isShowAlbumSettings:!1,isShowSignSettings:!1,isShowSetFriendsSign:!1}),i.props.toggleSettings()},i.chooseFriends=function(){l.a.send("VKWebAppGetFriends",{multi:!0})},i.onBridgeResult=function(e){if("VKWebAppGetFriendsResult"==e.detail.type){if(console.log("friends = "+JSON.stringify(e.detail.data)),void 0==e.detail.data||void 0==e.detail.data.users||0==e.detail.data.users.length)return;var t=i.props.dbUser;i.state.isShowSignSettings&&i.state.isShowSetFriendsSign?(void 0!=t.can_sign_list&&0!=t.can_sign_list.length||(t.can_sign_list=[]),e.detail.data.users.forEach((function(e){t.can_sign_list.includes(e.id)||t.can_sign_list.push(e.id)}))):i.state.isShowAlbumSettings&&i.state.isShowSetFriendsWatch&&(void 0!=t.can_watch_list&&0!=t.can_watch_list.length||(t.can_watch_list=[]),e.detail.data.users.forEach((function(e){t.can_watch_list.includes(e.id)||t.can_watch_list.push(e.id)}))),C(i.props.db,t),i.toggleSigns()}};var n=i.props.dbUser;return i.state={isShowSignSettings:!1,isShowAlbumSettings:!1,isShowSetFriendsSign:void 0!=n.can_sign_list&&n.can_sign_list.length>0,isShowSetFriendsWatch:void 0!=n.can_watch_list&&n.can_watch_list.length>0},i}return Object(d.a)(s,[{key:"componentDidUpdate",value:function(e){if(this.props!=e){var t=this.props.dbUser;this.setState({isShowSetFriendsSign:void 0!=t.can_sign_list&&t.can_sign_list.length>0,isShowSetFriendsWatch:void 0!=t.can_watch_list&&t.can_watch_list.length>0})}}},{key:"componentDidMount",value:function(){l.a.subscribe(this.onBridgeResult)}},{key:"render",value:function(){var e=this.props.dbUser,t=e.can_sign_list,s=e.can_watch_list;return Object(_.jsxs)("div",{className:this.props.isShowSettings?"appeal_container_bg_shown":"appeal_container_bg_hiden sdk_appeal_header",children:[Object(_.jsx)("div",{onClick:this.close,className:this.props.isShowSettings?"animateAppealBgShow":"animateAppealBgHide sdk_appeal_header"}),Object(_.jsxs)("div",{className:this.props.isShowSettings?"appeal_container_shown":"appeal_container_hide sdk_appeal_header",children:[!this.state.isShowSignSettings&&!this.state.isShowAlbumSettings&&Object(_.jsxs)("div",{className:"picker_cont",children:[Object(_.jsx)("p",{className:"picker_title",children:"\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u043f\u0440\u0438\u0432\u0430\u0442\u043d\u043e\u0441\u0442\u0438"}),Object(_.jsxs)("div",{onClick:this.showSignSettings,className:"just_cont",children:[Object(_.jsx)("p",{className:"settings_text",children:"\u041a\u0442\u043e \u043c\u043e\u0436\u0435\u0442 \u043e\u0441\u0442\u0430\u0432\u043b\u044f\u0442\u044c \u0430\u0432\u0442\u043e\u0433\u0440\u0430\u0444\u044b"}),Object(_.jsx)("p",{className:"settings_text blue",children:void 0!=t&&t.length>0?t.length+" "+U(t.length,"\u0434\u0440\u0443\u0433","\u0434\u0440\u0443\u0433\u0430","\u0434\u0440\u0443\u0437\u0435\u0439"):"\u0412\u0441\u0435"})]}),Object(_.jsxs)("div",{onClick:this.toggleAlbum,className:"just_cont",children:[Object(_.jsx)("p",{className:"settings_text",children:"\u041a\u0442\u043e \u043c\u043e\u0436\u0435\u0442 \u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0430\u043b\u044c\u0431\u043e\u043c"}),Object(_.jsx)("p",{className:"settings_text blue",children:void 0!=s&&s.length>0?s.length+" "+U(s.length,"\u0434\u0440\u0443\u0433","\u0434\u0440\u0443\u0433\u0430","\u0434\u0440\u0443\u0437\u0435\u0439"):"\u0412\u0441\u0435"})]})]}),this.state.isShowSignSettings&&Object(_.jsxs)("div",{className:"picker_cont",children:[Object(_.jsxs)("div",{className:"flex",children:[Object(_.jsx)("div",{style:{marginLeft:"-12px"},onClick:this.toggleSigns,className:"back_cont",children:Object(_.jsx)("img",{src:k})}),Object(_.jsx)("p",{className:"sign_title",children:"\u041a\u0442\u043e \u043c\u043e\u0436\u0435\u0442 \u043e\u0441\u0442\u0430\u0432\u043b\u044f\u0442\u044c \u0430\u0432\u0442\u043e\u0433\u0440\u0430\u0444\u044b"})]}),Object(_.jsxs)("div",{onClick:this.signSetAll,className:"just_cont",children:[Object(_.jsx)("p",{className:"settings_text",children:"\u0412\u0441\u0435"}),(void 0==t||0==t.length)&&!this.state.isShowSetFriendsSign&&Object(_.jsx)("img",{src:F})]}),Object(_.jsxs)("div",{onClick:this.signSetFriends,className:"just_cont",children:[Object(_.jsx)("p",{className:"settings_text",children:"\u0422\u043e\u043b\u044c\u043a\u043e \u0434\u0440\u0443\u0437\u044c\u044f"}),(void 0!=t&&t.length>0||this.state.isShowSetFriendsSign)&&Object(_.jsx)("img",{src:F})]}),this.state.isShowSetFriendsSign&&Object(_.jsx)("div",{onClick:this.chooseFriends,className:"pick_friends_btn",children:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u0431\u043b\u0438\u0437\u043a\u0438\u0445 \u0434\u0440\u0443\u0437\u0435\u0439"})]}),this.state.isShowAlbumSettings&&Object(_.jsxs)("div",{className:"picker_cont",children:[Object(_.jsxs)("div",{className:"flex",children:[Object(_.jsx)("div",{style:{marginLeft:"-12px"},onClick:this.toggleSigns,className:"back_cont",children:Object(_.jsx)("img",{src:k})}),Object(_.jsx)("p",{className:"sign_title",children:"\u041a\u0442\u043e \u043c\u043e\u0436\u0435\u0442 \u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0430\u043b\u044c\u0431\u043e\u043c"})]}),Object(_.jsxs)("div",{onClick:this.signWatchAll,className:"just_cont",children:[Object(_.jsx)("p",{className:"settings_text",children:"\u0412\u0441\u0435"}),(void 0==s||0==s.length)&&!this.state.isShowSetFriendsWatch&&Object(_.jsx)("img",{src:F})]}),Object(_.jsxs)("div",{onClick:this.signSetWatch,className:"just_cont",children:[Object(_.jsx)("p",{className:"settings_text",children:"\u0422\u043e\u043b\u044c\u043a\u043e \u0434\u0440\u0443\u0437\u044c\u044f"}),(void 0!=s&&s.length>0||this.state.isShowSetFriendsWatch)&&Object(_.jsx)("img",{src:F})]}),this.state.isShowSetFriendsWatch&&Object(_.jsx)("div",{onClick:this.chooseFriends,className:"pick_friends_btn",children:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u0431\u043b\u0438\u0437\u043a\u0438\u0445 \u0434\u0440\u0443\u0437\u0435\u0439"})]})]})]})}}]),s}(n.a.Component),R=s.p+"static/media/undo.c1300db5.svg",D=s.p+"static/media/redo.c6a14cbd.svg",T=s(43),W=function(e){Object(h.a)(s,e);var t=Object(p.a)(s);function s(e){return Object(r.a)(this,s),t.call(this,e)}return Object(d.a)(s,[{key:"render",value:function(){return Object(_.jsx)("div",{style:this.props.style?this.props.style:{},className:"account-content-loader loader-insta progress_bgstyle progress_bgstyle_earn top_56",children:Object(_.jsx)("div",{className:"top_0",children:Object(_.jsxs)("div",{className:"lds-ring_insta loader-earn-container",children:[Object(_.jsx)("div",{}),Object(_.jsx)("div",{}),Object(_.jsx)("div",{}),Object(_.jsx)("div",{})]})})})}}]),s}(n.a.Component),I=function(e){Object(h.a)(s,e);var t=Object(p.a)(s);function s(e){var i;return Object(r.a)(this,s),(i=t.call(this,e)).save=function(e){console.log("saved image = "+e),console.log("saved image = "+JSON.stringify(e)),i.setState({savedImage:e}),i.onImgLoaded(e)},i.onImgLoaded=function(e){var t=Object(N.b)(),s=(new Date).getTime(),n=Object(N.c)(t,s+".jpg"),a=Object(N.c)(t,"images/"+s+".jpg");n.name,a.name,n.fullPath,a.fullPath,Object(N.e)(n,e,"data_url").then((function(e){Object(N.a)(Object(N.c)(t,s+".jpg")).then(i.onSuccessLoaded).catch((function(e){console.log("error = "+e)}))}))},i.onSuccessLoaded=function(e){console.log("Uploaded a blob or file! url = "+e);var t=i.props.user,s=i.props.dbUser,n={type:2,text:"",url:e,name:t.first_name+" "+t.last_name,user_id:t.id};void 0==s.album||0==s.album.length?s.album=[n]:(void 0!=s.album&&s.album.length>1&&s.album.reverse(),s.album.push(n)),console.log("saveSign user = "+JSON.stringify(s)),C(i.props.db,s),i.close()},i.thicknessChanged=function(e){i.setState({thickness:Number(e.target.value)})},i.colorChanged=function(e){i.setState({color:e.target.value})},i.toggleSave=function(){i.setState({active:!1})},i.undo=function(){i.paintableRef.current.undo()},i.redo=function(){i.paintableRef.current.redo()},i.changeColor=function(){i.changeColorClick.current.click()},i.close=function(){document.getElementsByClassName("vkuiAppRoot").length>0&&(document.getElementsByClassName("vkuiAppRoot")[0].style.overflow="auto"),i.props.onTypePicked(-1)},i.state={thickness:5,color:"#FF3347",useEraser:!1,active:!0},i.paintableRef=n.a.createRef(),i.changeColorClick=n.a.createRef(),i}return Object(d.a)(s,[{key:"componentDidMount",value:function(){document.getElementsByClassName("vkuiAppRoot").length>0&&(document.getElementsByClassName("vkuiAppRoot")[0].style.overflow="hidden")}},{key:"render",value:function(){return Object(_.jsxs)("div",{className:"text_sign_screen",children:[Object(_.jsxs)("div",{style:{marginTop:"120px"},className:"nav_text_sign just_cont",children:[Object(_.jsx)("div",{onClick:this.close,className:"back_cont",children:Object(_.jsx)("img",{src:k})}),Object(_.jsxs)("div",{className:"flex",children:[Object(_.jsx)("div",{style:{marginTop:"-6px"},className:"edit_icon_cont",children:Object(_.jsx)("input",{className:"input_color",type:"color",value:this.state.color,onChange:this.colorChanged})}),Object(_.jsx)("div",{onClick:this.undo,className:"edit_icon_cont",children:Object(_.jsx)("img",{className:"edit_icon",src:R})}),Object(_.jsx)("div",{onClick:this.redo,className:"edit_icon_cont",children:Object(_.jsx)("img",{className:"edit_icon",src:D})}),Object(_.jsx)("div",{style:{marginRight:"12px"},onClick:this.toggleSave,className:"edit_icon_cont",children:Object(_.jsx)("img",{style:{height:"32px",width:"32px",margin:"12px 12px 0 12px"},src:F})})]})]}),Object(_.jsx)("div",{className:"canvas_container",children:Object(_.jsx)(T.a,{width:window.screen.width-16,height:window.screen.width,active:this.state.active,color:this.state.color,thickness:this.state.thickness,useEraser:this.state.useEraser,ref:this.paintableRef,image:localStorage.getItem("/")||void 0,onSave:this.save,onLongPress:function(){return console.log("long")},children:Object(_.jsx)("div",{className:"canvas-inner"})})}),Object(_.jsx)(W,{})]})}}]),s}(n.a.Component),L=new Image,E=new FileReader,J={},M=function(e){Object(h.a)(s,e);var t=Object(p.a)(s);function s(e){var i;return Object(r.a)(this,s),(i=t.call(this,e)).showTypePicker=function(){i.setState({isShowTypePicker:!0})},i.hidePicker=function(){i.setState({isShowTypePicker:!1})},i.onTypePicked=function(e){i.setState({type:e}),1==e&&i.pickImage()},i.uplFile=function(e){console.log("uploadFile file = "+e),J=e,E.onload=i.onLoadedFileReader,E.readAsDataURL(e)},i.onImgLoaded=function(){var e=Object(N.b)(),t=(new Date).getTime(),s=Object(N.c)(e,t+".jpg"),n=Object(N.c)(e,"images/"+t+".jpg");s.name,n.name,s.fullPath,n.fullPath,i.setState({isLoading:!0}),Object(N.d)(s,J).then((function(s){console.log("Uploaded a blob or file!"),i.setState({isLoading:!1}),Object(N.a)(Object(N.c)(e,t+".jpg")).then(i.onSuccessLoaded).catch((function(e){console.log("error = "+e)}))}))},i.onSuccessLoaded=function(e){console.log("Uploaded a blob or file! url = "+e),i.saveSign(e)},i.onLoadedFileReader=function(){L.onload=i.onImgLoaded,L.src=E.result},i.saveSign=function(e){var t=i.props.user,s=i.props.dbUser,n={type:1,text:"",url:e,name:t.first_name+" "+t.last_name,user_id:t.id};void 0==s.album||0==s.album.length?s.album=[n]:(void 0!=s.album&&s.album.length>1&&s.album.reverse(),s.album.push(n)),console.log("saveSign user = "+JSON.stringify(s)),C(i.props.db,s)},i.toggleSettings=function(){i.setState({isShowSettings:!i.state.isShowSettings})},i.state={isShowTypePicker:!1,isShowSettings:!1,type:-1,isLoading:!1},i.fileUpload=n.a.createRef(),i.pickImage=i.pickImage.bind(Object(u.a)(i)),i.fileChangedHandler=i.fileChangedHandler.bind(Object(u.a)(i)),i}return Object(d.a)(s,[{key:"componentDidMount",value:function(){}},{key:"fileChangedHandler",value:function(e){e&&e.target.files&&e.target.files.length>0&&(console.log("uploadFile file 1 = "+e.target.files[0]),this.uplFile(e.target.files[0]))}},{key:"pickImage",value:function(){this.fileUpload.current.click()}},{key:"render",value:function(){var e=this,t=this.props.dbUser;return-1==this.state.type||1==this.state.type?Object(_.jsxs)("div",{className:"main_container",children:[Object(_.jsx)("img",{className:"logo",src:g}),Object(_.jsxs)("div",{className:"relative",children:[void 0!=this.props.dbUser&&void 0!=this.props.dbUser.user&&Object(_.jsx)("p",{className:"name_title",children:this.props.dbUser.user.first_name+" "+this.props.dbUser.user.last_name}),this.props.isMyAlbum&&Object(_.jsx)("div",{onClick:this.toggleSettings,className:"settings_icon",children:Object(_.jsx)("img",{src:v})})]}),!this.props.isBlockedSign&&!this.props.isMyAlbum&&Object(_.jsx)("img",{onClick:this.showTypePicker,className:"add_img",src:m}),!this.props.isBLockedWatch&&Object(_.jsxs)("div",{className:"album_container",children:[void 0!=t.album&&t.album.length>0&&t.album.map((function(t,s){return Object(_.jsx)(y,{isMyAlbum:e.props.isMyAlbum,item:t,index:s},s)})),(void 0==t.album||0==t.album.length)&&Object(_.jsx)("img",{className:"empty_img",src:j})]}),this.props.isBLockedWatch&&Object(_.jsx)("img",{className:"empty_img",src:j}),Object(_.jsx)("input",{id:"fileInput",className:"custom-file-input hover",type:"file",accept:"image/*",onChange:this.fileChangedHandler,style:{display:"none"},ref:this.fileUpload}),Object(_.jsx)(P,{db:this.props.db,user:this.props.user,dbUser:this.props.dbUser,isShowSettings:this.state.isShowSettings,toggleSettings:this.toggleSettings}),Object(_.jsx)(x,{onTypePicked:this.onTypePicked,isShowTypePicker:this.state.isShowTypePicker,hidePicker:this.hidePicker})]}):0==this.state.type?Object(_.jsx)(w,{db:this.props.db,user:this.props.user,dbUser:this.props.dbUser,onTypePicked:this.onTypePicked}):2==this.state.type?Object(_.jsx)(I,{onTypePicked:this.onTypePicked,db:this.props.db,user:this.props.user,dbUser:this.props.dbUser}):void 0}}]),s}(n.a.Component),V=s(44),Q=function(e){Object(h.a)(s,e);var t=Object(p.a)(s);function s(e){var i;return Object(r.a)(this,s),(i=t.call(this,e)).add=function(){var e={user:i.props.user,album:[]};l.a.send("VKWebAppAddToProfile",{ttl:0}),Object(A.d)(Object(A.c)(i.props.db,"albums/"+i.props.user.id),e),i.props.openView("main")},i}return Object(d.a)(s,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return Object(_.jsxs)("div",{className:"main_container",children:[Object(_.jsx)("img",{className:"logo",src:g}),Object(_.jsx)("p",{className:"name_title descr_add",children:"\u0414\u043e\u0431\u0430\u0432\u044c\u0442\u0435 \u0441\u0441\u044b\u043b\u043a\u0443 \u043a \u0441\u0435\u0431\u0435 \u043d\u0430 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443, \u0447\u0442\u043e\u0431\u044b \u043b\u044e\u0434\u0438 \u043c\u043e\u0433\u043b\u0438 \u043e\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0432\u0430\u043c \u0430\u0432\u0442\u043e\u0433\u0440\u0430\u0444\u044b"}),Object(_.jsx)("div",{onClick:this.add,className:"center_hor add_btn sign_text_btn",children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"})]})}}]),s}(n.a.Component),Z={apiKey:"AIzaSyCI91wZXP2eaX-PDZ7vcUQITTDrKjksPBQ",authDomain:"vk-mini-apps-3d40e.firebaseapp.com",projectId:"vk-mini-apps-3d40e",storageBucket:"vk-mini-apps-3d40e.appspot.com",messagingSenderId:"313555575143",appId:"1:313555575143:web:64979e52b58521bf25cfc2",databaseURL:"https://vk-mini-apps-3d40e-default-rtdb.europe-west1.firebasedatabase.app/",measurementId:"G-8VWSLCYJHK"},X=function(e){Object(h.a)(s,e);var t=Object(p.a)(s);function s(){var e;return Object(r.a)(this,s),(e=t.call(this)).onBridgeResult=function(t){switch(t.detail.type){case"VKWebAppInitResult":case"VKWebAppAddToProfileResult":default:break;case"VKWebAppShowStoryBoxFailed":console.log("failed story - "+JSON.stringify(t.detail.data));break;case"VKWebAppGetUserInfoResult":console.log("vk_profile_id 3 = "+e.vk_profile_id),console.log("myid 3 = "+t.detail.data.id),e.vk_profile_id==t.detail.data.id&&e.setState({isMyAlbum:!0}),e.setState({user:t.detail.data}),e.checkUserInDb(t.detail.data),e.myId=t.detail.data.id}},e.getDbUser=function(t){var s=Object(A.c)(e.state.db,"albums/"+e.vk_profile_id);Object(A.b)(s,e.onFound)},e.checkUserInDb=function(t){var s=Object(A.c)(e.state.db,"albums/"+t.id);Object(A.b)(s,e.onUserFoundInDB)},e.onUserFoundInDB=function(t){var s=t.val();if(console.log("vk_profile_id = "+e.vk_profile_id),console.log("vk_profile_id 2 = "+B("vk_profile_id")),console.log("onUserFoundInDB = "+JSON.stringify(s)),(null==s||void 0==s)&&(null==B("vk_profile_id")||void 0==B("vk_profile_id")))return e.setState({isNewUser:!0,activeView:"add"}),void console.log("isNewUser = true");e.getDbUser()},e.onFound=function(t){var s=t.val();null!=s&&void 0!=s?(console.log("onFound"),e.myId!=s.user.id&&(void 0!=s.can_sign_list&&s.can_sign_list.length>0&&e.setState({isBlockedSign:!s.can_sign_list.includes(e.myId)}),void 0!=s.can_watch_list&&s.can_watch_list.length>0&&e.setState({isBLockedWatch:!s.can_watch_list.includes(e.myId)})),void 0!=s.album&&s.album.length>1&&s.album.reverse(),e.setState({dbUser:s})):console.log("onFound not")},e.openView=function(t){e.setState({activeView:t})},e.state={activeView:"main",db:{},log:"",isMyAlbum:!1,user:{},isNewUser:!1,dbUser:{},isBlockedSign:!1,isBLockedWatch:!1},e}return Object(d.a)(s,[{key:"componentDidMount",value:function(){var e=Object(V.a)(Z);this.database=Object(A.a)(e),this.setState({db:this.database}),l.a.send("VKWebAppInit"),l.a.send("VKWebAppGetUserInfo"),l.a.subscribe(this.onBridgeResult);var t=B("vk_profile_id");console.log("vk_profile_id 1 = "+t),void 0!=t&&""!=t||(t="688075262"),this.vk_profile_id=t,console.log("vk_profile_id 2 = "+this.vk_profile_id)}},{key:"render",value:function(){return Object(_.jsx)(b.a,{children:Object(_.jsx)(b.b,{children:Object(_.jsxs)(b.d,{activeView:this.state.activeView,children:[Object(_.jsx)(b.e,{id:"main",activePanel:"main_panel",children:Object(_.jsx)(b.c,{id:"main_panel",children:Object(_.jsx)(M,{isBLockedWatch:this.state.isBLockedWatch,isBlockedSign:this.state.isBlockedSign,user:this.state.user,dbUser:this.state.dbUser,isMyAlbum:this.state.isMyAlbum,log:this.state.log,db:this.state.db,openView:this.openView})})}),Object(_.jsx)(b.e,{id:"add",activePanel:"add_panel",children:Object(_.jsx)(b.c,{id:"add_panel",children:Object(_.jsx)(Q,{isNewUser:this.state.isNewUser,isMyAlbum:this.state.isMyAlbum,user:this.state.user,db:this.state.db,openView:this.openView})})})]})})})}}]),s}(n.a.Component),G=X;c.a.render(Object(_.jsx)(X,{}),document.getElementById("root")),l.a.send("VKWebAppInit"),c.a.render(Object(_.jsx)(G,{}),document.getElementById("root"))}},[[184,1,2]]]);
//# sourceMappingURL=main.c260c181.chunk.js.map